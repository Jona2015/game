<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>2D Slither.io â€“ Advanced AI</title>
<style>
body { margin:0; background:#111; overflow:hidden; }
canvas { display:block; }
#adminPanel {
  position:fixed; left:10px; top:10px;
  background:#222a; color:white;
  padding:10px; border-radius:8px;
}
</style>
</head>
<body>

<div id="adminPanel">
  <input type="password" id="adminPin" placeholder="PIN"><br>
  <button onclick="admin.killAllBots()">Kill All Bots</button>
</div>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

const WORLD_SIZE = 3000;

// ===== ZOOM =====
let zoom = 0.3;
window.addEventListener('wheel', e=>{
  zoom=Math.max(0.15,Math.min(1.2,zoom-e.deltaY*0.0015));
},{passive:false});

// ===== INPUT =====
let keys={w:0,a:0,s:0,d:0};
window.addEventListener('keydown',e=>{
  if(e.code==='KeyW') keys.w=1;
  if(e.code==='KeyA') keys.a=1;
  if(e.code==='KeyS') keys.s=1;
  if(e.code==='KeyD') keys.d=1;
  if(e.code==='Space') player.boost=true;
});
window.addEventListener('keyup',e=>{
  if(e.code==='KeyW') keys.w=0;
  if(e.code==='KeyA') keys.a=0;
  if(e.code==='KeyS') keys.s=0;
  if(e.code==='KeyD') keys.d=0;
  if(e.code==='Space') player.boost=false;
});

// ===== UTILS =====
const rand=(a,b)=>Math.random()*(b-a)+a;
const dist=(a,b)=>Math.hypot(a.x-b.x,a.y-b.y);

// ===== FOOD =====
const foods=[];
for(let i=0;i<15000;i++)
  foods.push({x:rand(-WORLD_SIZE,WORLD_SIZE),y:rand(-WORLD_SIZE,WORLD_SIZE)});

// ===== PARTICLES =====
const particles=[];
function explode(x,y,c){
  for(let i=0;i<50;i++)
    particles.push({x,y,vx:rand(-3,3),vy:rand(-3,3),life:40,c});
}

// ===== SNAKE =====
class Snake{
  constructor(x,y,c,isBot=false){
    this.segments=[{x,y}];
    this.len=20;
    this.speed=4;
    this.angle=0;
    this.boost=false;
    this.color=c;
    this.dead=false;
    this.isBot=isBot;
    this.boostTick=0;
  }
  update(target){
    if(this.dead) return;

    // BOOST LOGIK
    let sp=this.speed;
    if(this.boost && this.len>10){
      sp*=2.3;
      this.len-=0.15;
      this.boostTick++;
      if(this.boostTick%5===0){
        const t=this.segments[this.segments.length-1];
        foods.push({x:t.x+rand(-5,5),y:t.y+rand(-5,5)});
      }
    }

    if(target)
      this.angle=Math.atan2(target.y-this.segments[0].y,target.x-this.segments[0].x);

    const h=this.segments[0];
    this.segments.unshift({
      x:h.x+Math.cos(this.angle)*sp,
      y:h.y+Math.sin(this.angle)*sp
    });

    while(this.segments.length>this.len) this.segments.pop();
  }
  draw(){
    ctx.fillStyle=this.color;
    for(const s of this.segments){
      ctx.beginPath();
      ctx.arc(s.x,s.y,6,0,Math.PI*2);
      ctx.fill();
    }
  }
}

// ===== PLAYER =====
const player=new Snake(0,0,'lime');

// ===== BOTS =====
const bots=[];
for(let i=0;i<25;i++)
  bots.push(new Snake(rand(-1500,1500),rand(-1500,1500),'red',true));

window.admin={
  killAllBots(){
    bots.forEach(b=>{
      explode(b.segments[0].x,b.segments[0].y,'red');
      b.dead=true;
      setTimeout(()=>{
        b.segments=[{x:rand(-WORLD_SIZE,WORLD_SIZE),y:rand(-WORLD_SIZE,WORLD_SIZE)}];
        b.len=rand(20,120);
        b.dead=false;
      },800);
    });
  }
};

// ===== CAMERA =====
let camera={x:0,y:0};

// ===== LOOP =====
function loop(){
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  camera.x=player.segments[0].x;
  camera.y=player.segments[0].y;

  ctx.translate(canvas.width/2,canvas.height/2);
  ctx.scale(zoom,zoom);
  ctx.translate(-camera.x,-camera.y);

  // FOOD
  ctx.fillStyle='orange';
  for(const f of foods){
    ctx.beginPath();
    ctx.arc(f.x,f.y,4,0,Math.PI*2);
    ctx.fill();
    if(dist(player.segments[0],f)<10){
      player.len+=2;
      foods.splice(foods.indexOf(f),1);
    }
  }

  // PLAYER MOVE
  let mx=keys.d-keys.a;
  let my=keys.s-keys.w;
  let target=mx||my?{x:player.segments[0].x+mx*100,y:player.segments[0].y+my*100}:null;
  player.update(target);

  // ===== BOT KI =====
  bots.forEach(b=>{
    if(b.dead) return;
    let t;

    const d=dist(b.segments[0],player.segments[0]);

    if(d<700){
      if(b.len>player.len*1.1){
        // ANGREIFEN
        t=player.segments[0];
        b.boost=true;
      }else{
        // FLUCHT
        b.boost=true;
        const a=Math.atan2(
          b.segments[0].y-player.segments[0].y,
          b.segments[0].x-player.segments[0].x
        );
        t={
          x:b.segments[0].x+Math.cos(a)*300,
          y:b.segments[0].y+Math.sin(a)*300
        };
      }
    }else{
      // FOOD FARMEN
      b.boost=false;
      t=foods[Math.floor(Math.random()*foods.length)];
    }

    b.update(t);
  });

  // DRAW
  player.draw();
  bots.forEach(b=>b.draw());

  // PARTICLES
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    p.x+=p.vx; p.y+=p.vy; p.life--;
    ctx.fillStyle=p.c;
    ctx.fillRect(p.x,p.y,2,2);
    if(p.life<=0) particles.splice(i,1);
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
