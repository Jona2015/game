<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Slither.io Ultimate Smarte Bots Angriff</title>
<style>
body{margin:0;background:#111;overflow:hidden;font-family:Arial;color:white;}
canvas{display:block;}
#minimap{position:fixed;top:10px;right:10px;width:160px;height:160px;background:#000c;border:2px solid #555;}
#leaderboard{position:fixed;left:10px;top:10px;background:#000c;padding:8px;border-radius:8px;font-size:14px;}
#scoreDisplay{position:fixed;bottom:10px;left:50%;transform:translateX(-50%);font-size:20px;color:lime;}
#commandInput{position:fixed;bottom:50px;left:50%;transform:translateX(-50%);width:300px;padding:5px;font-size:16px;background:#000a;border:1px solid white;color:white;}
#menu{position:fixed;top:0;left:0;width:100%;height:100%;background:#000f;display:flex;align-items:center;justify-content:center;flex-direction:column;color:white;font-family:Arial;}
#menu input,#menu select,#menu button{margin:5px;padding:5px;font-size:16px;}
</style>
</head>
<body>

<div id="menu">
<h1>Slither.io Ultimate</h1>
<input id="playerName" placeholder="Name" />
<select id="difficulty">
<option value="easy">Leicht</option>
<option value="medium" selected>Mittel</option>
<option value="hard">Schwer</option>
</select>
<select id="skin">
<option value="lime">Grün</option>
<option value="cyan">Cyan</option>
<option value="yellow">Gelb</option>
<option value="magenta">Magenta</option>
</select>
<button id="startBtn">Start</button>
<div id="startAnim" style="margin-top:20px;font-size:18px;color:orange;"></div>
</div>

<div id="leaderboard"></div>
<div id="scoreDisplay">Score: 0 | Highscore: 0</div>
<input id="commandInput" placeholder="Command: /spawn bot 10 /spawn food 100 /kill bots /score 500" />

<canvas id="game"></canvas>
<canvas id="minimap"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const mini=document.getElementById("minimap");
const mctx=mini.getContext("2d");
const menu=document.getElementById("menu");
const startBtn=document.getElementById("startBtn");
const playerNameInput=document.getElementById("playerName");
const difficultySelect=document.getElementById("difficulty");
const skinSelect=document.getElementById("skin");
const leaderboardDiv=document.getElementById("leaderboard");
const scoreDisplay=document.getElementById("scoreDisplay");
const commandInput=document.getElementById("commandInput");

canvas.width=innerWidth;
canvas.height=innerHeight;
mini.width=mini.height=160;

const WORLD=10000;
let zoom=0.3;
let camera={x:0,y:0};
let foods=[];
let highscore=parseInt(localStorage.getItem("slitherHighscore")||0);

const rand=(a,b)=>Math.random()*(b-a)+a;
const dist=(a,b)=>Math.hypot(a.x-b.x,a.y-b.y);

class Snake{
  constructor(x,y,color,bot=false,name=null){
    this.segments=[{x,y}];
    this.len=rand(50,120);
    this.width=14;
    this.speed=4;
    this.angle=0;
    this.boost=false;
    this.dead=false;
    this.bot=bot;
    this.color=color;
    this.name=name||(bot?"Bot":"Spieler");
    this.boostTick=0;
  }
  update(target){
    if(this.dead)return;
    let sp=this.speed;
    if(this.boost && this.len>10){
      sp*=2.3;
      this.len-=0.2;
      this.boostTick++;
      if(this.boostTick%3===0){
        const t=this.segments.at(-1);
        foods.push({x:t.x+rand(-5,5),y:t.y+rand(-5,5)});
      }
    }
    if(target)this.angle=Math.atan2(target.y-this.segments[0].y,target.x-this.segments[0].x);
    const h=this.segments[0];
    this.segments.unshift({x:h.x+Math.cos(this.angle)*sp,y:h.y+Math.sin(this.angle)*sp});
    while(this.segments.length>this.len)this.segments.pop();
  }
  draw(ctx){
    ctx.fillStyle=this.color;
    for(const s of this.segments){
      ctx.beginPath();
      ctx.arc(s.x,s.y,this.width/2,0,Math.PI*2);
      ctx.fill();
    }
  }
}

/* =================== SPIELER & BOTS =================== */
let player,bots=[];
function initGame(){
  player=new Snake(0,0,skinSelect.value,false,playerNameInput.value||"Player");
  foods=[];
  for(let i=0;i<60000;i++)foods.push({x:rand(-WORLD,WORLD),y:rand(-WORLD,WORLD)});
  bots=[];
  const botCount=difficultySelect.value==="easy"?30:difficultySelect.value==="medium"?50:70; 
  const colors=["red","orange","cyan","violet","yellow","magenta"];
  for(let i=0;i<botCount;i++)bots.push(new Snake(rand(-WORLD/2,WORLD/2),rand(-WORLD/2,WORLD/2),colors[i%colors.length],true));
}

/* =================== INPUT =================== */
let keys={s:0,a:0,w:0,d:0};
onkeydown=e=>{if(e.code==="KeyW")keys.s=1;if(e.code==="KeyA")keys.a=1;if(e.code==="KeyS")keys.w=1;if(e.code==="KeyD")keys.d=1;if(e.code==="Space")player.boost=true;}
onkeyup=e=>{if(e.code==="KeyW")keys.s=0;if(e.code==="KeyA")keys.a=0;if(e.code==="KeyS")keys.w=0;if(e.code==="KeyD")keys.d=0;if(e.code==="Space")player.boost=false;}
canvas.addEventListener("wheel",e=>{e.preventDefault();zoom=Math.max(0.15,Math.min(1.2,zoom*(1-e.deltaY*0.0015)));},{passive:false});

/* =================== COMMAND LINE =================== */
commandInput.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    const cmd=commandInput.value.trim();
    const parts=cmd.split(" ");
    if(parts[0]==="/spawn" && parts[1]==="bot" && !isNaN(parts[2])){
      for(let i=0;i<parseInt(parts[2]);i++){
        const colors=["red","orange","cyan","violet","yellow","magenta"];
        bots.push(new Snake(rand(-WORLD/2,WORLD/2),rand(-WORLD/2,WORLD/2),colors[i%colors.length],true));
      }
    }
    else if(parts[0]==="/spawn" && parts[1]==="food" && !isNaN(parts[2])){
      for(let i=0;i<parseInt(parts[2]);i++)foods.push({x:rand(-WORLD,WORLD),y:rand(-WORLD,WORLD)});
    }
    else if(cmd==="/kill bots"){bots.forEach(b=>dropLength(b));bots.forEach(b=>b.dead=true);}
    else if(parts[0]==="/score" && !isNaN(parts[1]))player.len=parseInt(parts[1]);
    commandInput.value="";
  }
});

/* =================== SMART BOT LOGIK MIT ANGRIFF =================== */
function smartBotTarget(bot){
  if(bot.dead)return null;
  let visible=[player,...bots.filter(b=>b!==bot&&!b.dead)];
  visible.sort((a,b)=>dist(bot.segments[0],a.segments[0])-dist(bot.segments[0],b.segments[0]));
  for(let t of visible){
    const d=dist(bot.segments[0],t.segments[0]);
    if(t===player){ 
      if(bot.len>t.len*1.05)return t.segments[0]; 
      else if(d<600){ 
        const a=Math.atan2(bot.segments[0].y-t.segments[0].y,bot.segments[0].x-t.segments[0].x);
        return {x:bot.segments[0].x+Math.cos(a)*300,y:bot.segments[0].y+Math.sin(a)*300};
      }
    }else{
      if(bot.len>t.len*1.05 && d<600)return t.segments[0];
      else if(bot.len<t.len*0.95 && d<400){
        const a=Math.atan2(bot.segments[0].y-t.segments[0].y,bot.segments[0].x-t.segments[0].x);
        return {x:bot.segments[0].x+Math.cos(a)*200,y:bot.segments[0].y+Math.sin(a)*200};
      }
    }
  }
  return foods[Math.floor(Math.random()*foods.length)];
}

/* =================== DROPPEN DER LÄNGE =================== */
function dropLength(snake){
  for(let i=0;i<Math.floor(snake.len);i+=5)foods.push({x:snake.segments[0].x+rand(-20,20),y:snake.segments[0].y+rand(-20,20)});
}

/* =================== GAME LOOP =================== */
function loop(){
  requestAnimationFrame(loop);
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  camera.x+=(player.segments[0].x-camera.x)*0.08;
  camera.y+=(player.segments[0].y-camera.y)*0.08;
  ctx.translate(canvas.width/2,canvas.height/2);
  ctx.scale(zoom,zoom);
  ctx.translate(-camera.x,-camera.y);

  // Map Rand
  ctx.strokeStyle="white"; ctx.lineWidth=8;
  ctx.strokeRect(-WORLD,-WORLD,WORLD*2,WORLD*2);
  const ph=player.segments[0];
  if(ph.x<-WORLD||ph.x>WORLD||ph.y<-WORLD||ph.y>WORLD)player.dead=true;
  bots.forEach(b=>{if(b.dead)return;const bh=b.segments[0];if(bh.x<-WORLD||bh.x>WORLD||bh.y<-WORLD||bh.y>WORLD)b.dead=true;});

  // Food
  ctx.fillStyle="orange";
  for(const f of foods){ctx.beginPath();ctx.arc(f.x,f.y,4,0,Math.PI*2);ctx.fill();
    if(!player.dead && dist(ph,f)<12){player.len+=2;player.width+=0.05;foods.splice(foods.indexOf(f),1);}
  }

  // Spieler
  const mx=keys.d-keys.a; const my=keys.w-keys.s;
  const target=mx||my?{x:ph.x+mx*100,y:ph.y+my*100}:null;
  if(!player.dead)player.update(target);

  // Bots KI
  bots.forEach(b=>{if(b.dead)return;b.boost=true;b.update(smartBotTarget(b));});

  // Kollisionslogik – Spieler & Bots
  bots.forEach(b=>{
    if(b.dead)return;
    // Bot Kopf → Spieler Körper = Bot tot
    for(let i=15;i<player.segments.length;i++)if(dist(b.segments[0],player.segments[i])<6){dropLength(b);b.dead=true;}
    // Spieler Kopf → Bot Körper = Spieler tot
    for(let i=15;i<b.segments.length;i++)if(dist(player.segments[0],b.segments[i])<6){dropLength(player);player.dead=true;}
    // Bots untereinander
    for(let other of bots){if(other===b||other.dead)continue;for(let i=15;i<other.segments.length;i++)if(dist(b.segments[0],other.segments[i])<6){dropLength(b);b.dead=true;}}
  });

  // Respawn
  bots.forEach(b=>{if(b.dead)setTimeout(()=>{b.segments=[{x:rand(-WORLD,WORLD),y:rand(-WORLD,WORLD)}];b.len=rand(50,120);b.width=14;b.dead=false;},800);});
  if(player.dead)setTimeout(()=>{player.segments=[{x:0,y:0}];player.len=80;player.width=14;player.dead=false;},800);

  // Draw
  player.draw(ctx); bots.forEach(b=>!b.dead&&b.draw(ctx));

  // Leaderboard + Score
  const lb=[player,...bots].filter(s=>!s.dead).sort((a,b)=>b.len-a.len).slice(0,5);
  leaderboardDiv.innerHTML="<b>Leaderboard</b><br>"+lb.map((s,i)=>`${i+1}. ${s.name} (${Math.floor(s.len)})`).join("<br>");
  scoreDisplay.innerHTML=`Score: ${Math.floor(player.len)} | Highscore: ${highscore}`;
  if(Math.floor(player.len)>highscore){highscore=Math.floor(player.len);localStorage.setItem("slitherHighscore",highscore);}

  // Minimap
  mctx.clearRect(0,0,160,160);
  const sc=160/(WORLD*2);
  const dot=(x,y,c)=>{ mctx.fillStyle=c; mctx.fillRect(80+x*sc,80+y*sc,3,3); };
  dot(ph.x,ph.y,"lime"); bots.forEach(b=>!b.dead&&dot(b.segments[0].x,b.segments[0].y,"red"));
}

/* =================== START =================== */
startBtn.onclick=()=>{
  menu.style.display="none";
  initGame();
  let anim=0;
  const animInterval=setInterval(()=>{document.getElementById("startAnim").innerText="Get Ready"+'.'.repeat(anim%4);anim++;if(anim>12)clearInterval(animInterval);},200);
  loop();
};
</script>
</body>
</html>
