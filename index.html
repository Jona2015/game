<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Slither.io Multiplayer</title>
<style>
body { margin:0; background:#111; overflow:hidden; font-family:Arial,sans-serif; color:white;}
canvas { display:block; }
#scoreDisplay { position:fixed; top:10px; left:10px; color:lime; font-size:18px; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="scoreDisplay">Score: 0</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = innerWidth;
canvas.height = innerHeight;

const WORLD_SIZE = 3000;
let zoom = 0.3;
let camera = {x:0,y:0};
let score = 0;

const keys = {};
onkeydown = e => keys[e.key] = true;
onkeyup = e => keys[e.key] = false;

// WebSocket
const SERVER_IP = "192.168.1.100"; // <-- IP vom Server-PC
const socket = new WebSocket(`ws://${SERVER_IP}:3000`);

let playerId = null;
let otherPlayers = {};

// Snake Klasse
class Snake{
  constructor(x,y,c='lime'){
    this.segments=[{x,y}];
    this.len=20;
    this.speed=4;
    this.angle=0;
    this.boost=false;
    this.color=c;
    this.dead=false;
  }
  update(target){
    if(this.dead) return;
    let sp = this.speed;
    if(this.boost && this.len>10){ sp*=2; this.len-=0.15; }
    if(target) this.angle=Math.atan2(target.y-this.segments[0].y,target.x-this.segments[0].x);
    const h=this.segments[0];
    this.segments.unshift({x:h.x+Math.cos(this.angle)*sp, y:h.y+Math.sin(this.angle)*sp});
    while(this.segments.length>this.len) this.segments.pop();
  }
  draw(ctx){
    ctx.fillStyle=this.color;
    for(const s of this.segments){
      ctx.beginPath();
      ctx.arc(s.x,s.y,6,0,Math.PI*2);
      ctx.fill();
    }
  }
}

const player = new Snake(0,0,'lime');
let foods=[];
for(let i=0;i<2000;i++) foods.push({x:(Math.random()*2-1)*WORLD_SIZE, y:(Math.random()*2-1)*WORLD_SIZE});

// WebSocket Events
socket.onmessage = e => {
  const data = JSON.parse(e.data);
  if(data.type==='init') playerId = data.id;
  else if(data.type==='players') otherPlayers = data.players;
};

// Input
let mouse={x:0,y:0};
canvas.addEventListener('mousemove', e=>{ mouse.x=e.clientX; mouse.y=e.clientY; });

// Game Loop
function loop(){
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  camera.x += (player.segments[0].x - camera.x)*0.08;
  camera.y += (player.segments[0].y - camera.y)*0.08;

  ctx.translate(canvas.width/2,canvas.height/2);
  ctx.scale(zoom,zoom);
  ctx.translate(-camera.x,-camera.y);

  // Map Rand
  ctx.strokeStyle='white';
  ctx.lineWidth=10;
  ctx.strokeRect(-WORLD_SIZE,-WORLD_SIZE,WORLD_SIZE*2,WORLD_SIZE*2);

  // Player movement
  let target={x:player.segments[0].x, y:player.segments[0].y};
  if(keys['w']) target.y -= 100;
  if(keys['s']) target.y += 100;
  if(keys['a']) target.x -= 100;
  if(keys['d']) target.x += 100;
  player.update(target);

  // Food
  ctx.fillStyle='orange';
  for(const f of foods){
    ctx.beginPath();
    ctx.arc(f.x,f.y,4,0,Math.PI*2);
    ctx.fill();
    if(Math.hypot(player.segments[0].x-f.x, player.segments[0].y-f.y)<10){ player.len+=2; foods.splice(foods.indexOf(f),1); }
  }

  // Draw other players
  for(const id in otherPlayers){
    if(id===playerId) continue;
    const p = otherPlayers[id];
    const s = new Snake(0,0,'cyan');
    s.segments = p.segments;
    s.dead = p.dead;
    s.draw(ctx);
  }

  player.draw(ctx);

  // Score
  score = Math.floor(player.len);
  document.getElementById('scoreDisplay').innerText = `Score: ${score}`;

  // Send update to server
  if(socket.readyState===1 && playerId){
    socket.send(JSON.stringify({
      type:'update',
      x: player.segments[0].x,
      y: player.segments[0].y,
      len: player.len,
      segments: player.segments,
      dead: player.dead
    }));
  }

  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
